[TOC]

# 概述
身份与访问控制是安全中非常重要的内容，用于保证只有授权的主体(拥有权限)才允许访问提供服务的客体。

一次访问操作，一般包括主体(发起方)、客体(服务提供方)和访问控制规则

主体:需要进行身份验证, 权限判断
客体:比较广泛，可能包括信息、系统、设备、设施和人员。
主体和客体可以来回切换

不看这些，大部分系统也是遵循这种方式进行实施的

# 身份标识
最核心的一条 **唯一性**，比如公民手机号、身份证号、用户名(注册时需要判断是否已经存在)

目前大部分系统都是用手机号作为身份标识，公司内部系统一般都是使用员工名的拼音(重名加数字后缀)


# 身份验证 

### 注册
双方共有的信息(用户和银行共有用户的身份证号和社保卡号)，或者注册时需要进行挑战应答，证明确实是你的(比如短信验证码，邮箱验证码)或使用第三方信息进行注册管理

越安全的身份验证，注册过程越复杂

_安全建议_ 防止用户唯一标识被覆盖

### 验证因素
##### 类型1 -> 你知道什么 -> 密码

注意事项:
- 长度
- 复杂度 -> 短语密码
- 更换周期 -> 两次是否允许相同，与其他系统是否相同
- 存储是否不可逆 -> 加盐
- 密码找回  -> 认知密码事先录入信息
- 禁止共享

##### 类型2 -> 你有什么 -> token、智能卡(微处理器)
智能卡 ID或徽章，嵌入集成电路芯片，包括微处理器以及一个或多个证书，二次认证包括PIN或密码

美国->通用访问卡(Common Access Card,CAC)或个人身份验证(Personal Identity Verfication PIV)是智能卡，包括有关所有者的照片和其他识别信息。

令牌 同步动态密码令牌(基于时间)

异步动态令牌(基于算法和递增生成器 先获得一个随机值，输入令牌，获得一次密码)

手机短信验证码->两步验证(类似硬件令牌)，电子邮件发送pin码
##### 类型3 你是什么->生物特征
声纹、视网膜、虹膜、掌纹、手型、心脏/脉冲、签名动态、击键模式

- 误差比较大

I类错误  FRR(错误拒绝率) 漏报  假阴性
II类错误 FAR(错误接受率) 误报  假阳性

FRR与FAR交叉点 是错误交叉率(CER)/等错误率(ERR)  越低越好

- 注册比较耗时
注册时间长、吞吐率、接受度

##### 其他类型
多因素认证 是表示多种类型的因素，非单一因素的两种方式

你所在的地方 -> IP变化
上下文感知身份验证 -> 当前运行环境

### 身份管理
集中式和分散式

##### LDAP
基于LDAP(目录服务器)进行存储和管理的，需要进行安全加固，如windows AD,端口号是389


基于MySQL等数据库进行存储和管理用户身份

##### RADIUS
使用UDP，并仅对密码的交换进行加密，不会加密整个会话，可使用其他协议来加密数据会话
端口:1812 认证, 1813 计费

##### TACACS+
TACACS/XTACACS/TACACS+

因为是思科专有协议，用的比较少
TACACS+使用的最多，加密所有身份验证信息，使用udp 49, 和tcp 49为数据包传输提供更高可靠性

##### Diameter
支持多种协议，包括传统IP、移动IP、VoIP, 无线设备和智能手机
是RADIUS增强版，但不兼容RADIUS 
使用TCP 3868 SCTP协议，支持IPsec和TLS

### 验证实施
一般采用单点登录(single Sign-on SSO)进行身份验证

##### Kerberos
常用的SSO技术，AD主要采用这种技术，与时间关系非常紧密，时间差值一定要在一定范围内。

票据认证是一种利用第三方实体来证明身份并提供身份验证机制，依赖AES

###### KDC
 KDC(密钥分发中心)，客户端和服务器都在KDC中注册，并为所有网络成员维护密钥

 - TGS(票据授予服务)
 TGT(票据授予票据)->加密的,包括对称密钥、到期时间和用户的IP地址
服务票据(ST)->主体访问客体的证据

- AS(身份验证服务)
验证过程:
kerberos 不会传输用户的密码，而是KDC使用用户的密码hash加密对称密钥，发给客户端，客户端进行解密操作，如果解密成功表示用户有该密码

KDC单点故障，对时间比较严格

##### 联合身份管理和SSO
基于云的应用程序使用联合身份管理(FIM)
联合身份系统通常使用安全断言标记语言(Security Assertion Markup Language,SAML)或服务配置标记语言(Service Provisioning Markup Language,SPML)

HTML->SGML/GML
可扩展标记语言XML
安全断言标记语言，SAML,通常用于在联合组织之间交换身份验证和授权(AA)信息，主流的SSO语言
服务配置标记语言，SPML, 由OASIS开发的一种新框架，交换用于联合身份SSO目的的用户信息
OAuth 
OpenID,提供分散身份验证，允许用户使用由第三方服务维护的一组凭据登陆多个不相关的网站

身份即服务(Identity as a Service, IDaaS) 为云提供SSO



# 授权管理
安全策略->定义组织安全要求的文档

### 权限、权利、特权
特权=权限+权利
权限->单独一个授权
权利->权限的集合

### 授权机制
- 隐式拒绝
- 访问控制矩阵ACL->客体为中心
- 能力表->主体为中心
- 约束接口->限制用户可执行或查看的内容
- 依赖内容->数据库视图
- 依赖上下文的控制
- 知其所需
- 最小特权->包括知其所需，还包括权利
- 职责分离

###  访问控制类型
预防: 控制试图**阻止**不必要或未经授权的活动发生，eg:栅栏、锁、生物识别、照明、陷阱、警报、职责分离、岗位轮换、数据分类、渗透、加密、审计、安全摄像头、CCTV、安全意识、反病毒，Firewall,IPS

检查: 尝试**发现或检测**不需要的或未经授权的活动，eg: CCTV捕获的事件，岗位轮换、强制休假策略

纠正: 纠正控制修改环境，以便在发生意外或未经授权的活动后将系统**恢复正常**。eg: 重启系统，删除病毒，备份和恢复

威慑->与预防相似，更多强调个人决定不采取不必要行动

恢复->纠正的扩展，更加高级或复杂，有备份和还原，虚拟镜像

指示->指导、限制或控制主体，以加强或鼓励遵守安全策略，eg:安全策略要求或标准、发布通知、逃生路线、监视、监督和程序

补偿->替代方案

管理->人
逻辑/技术->技术
物理控制->物理

### 5种访问控制模型
#####  自主访问控制(DAC)
客体有一个所有者，可授予或拒绝其他任何主体的访问
微软的NTFS

#####  基于角色的访问控制（RBAC)
微软操作系统
有助于阻止特权蠕动，强制执行最小特权

##### 基于规则的访问控制
适用于所有主体的全局规则，防火墙，有时称为限制或过滤器
##### 属性的访问控制(ABAC)
多个属性的规则，软件定义网络
##### 强制访问控制(MAC)
主客体都有标签，基于格子的模型

### 常见问题
过度权限:拥有比工作需要更多的权限

蠕变权限:工作岗位变更积累的权限

基于生命周期进行管理: 创建 ->使用->删除 

# 记录/审计
记录最核心的是操作时间，人，动作

授权->信任谁执行特定操作，原则:最小特权
问责->审计、记录、监控确保主体对其行为负责